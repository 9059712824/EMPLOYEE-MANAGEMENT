@model EMPLOYEE_MANAGEMENT.Models.AcademicDetails
@{
    ViewBag.Title = "Add Academic Details";
}
<form method="post" action="AddAcademicDetails" class="mt-5" enctype="multipart/form-data">
    <div id="academicContainer">
        <div class="academicEntry">
            <div class="mb-3">
                <label for="Name" class="form-label">Academic Name</label>
                <select class="form-control" name="academicDetails[0].Name" required>
                    <option value="School">School</option>
                    <option value="Intermediate(10+2)">Intermediate(10+2)</option>
                    <option value="Diploma">Diploma</option>
                    <option value="BSC">B.SC</option>
                    <option value="BCA">B.CA</option>
                    <option value="BTech">B.Tech</option>
                    <option value="MTech">M.Tech</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="StartYear" class="form-label">Start Year</label>
                <select class="form-control" name="academicDetails[0].StartYear" required>
                    <option value="">Select year</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="EndYear" class="form-label">End Year</label>
                <select class="form-control" name="academicDetails[0].EndYear" required>
                    <option value="">Select year</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="proof" class="form-label">Proof</label>
                <input type="file" name="academicDetails[0].proof" required />
            </div>
        </div>
    </div>

    <button type="button" id="addAcademic" class="btn btn-primary">+ Add Academic</button>
    <button type="submit" class="btn btn-primary">Submit</button>
</form>

<script>
    var startYearSelect = document.querySelectorAll("select[name^='academicDetails'][name$='.StartYear']");
    var endYearSelect = document.querySelectorAll("select[name^='academicDetails'][name$='.EndYear']");
    var currentYear = new Date().getFullYear();

    // Populate the start year dropdowns
    for (var i = 0; i < startYearSelect.length; i++) {
        var startYearSelectElem = startYearSelect[i];
        for (var year = 2000; year <= currentYear; year++) {
            var option = document.createElement("option");
            option.value = year;
            option.text = year;
            startYearSelectElem.appendChild(option);
        }
    }

    // Update end year options based on start year selection
    function updateEndYearOptions(startYearSelectElem, endYearSelectElem) {
        var startYear = parseInt(startYearSelectElem.value);

        var nameSelect = startYearSelectElem.parentNode.previousElementSibling.querySelector("select[name^='academicDetails'][name$='.Name']");
        var selectedValue = nameSelect.value;

        if (selectedValue === "School") {
            startYear++;
        } else if (selectedValue === "Intermediate(10+2)") {
            startYear += 2;
        } else if (selectedValue === "Diploma") {
            startYear += 3;
        } else if (selectedValue === "BSC") {
            startYear += 3;
        } else if (selectedValue === "BCA") {
            startYear += 3;
        } else if (selectedValue === "BTech") {
            startYear += 4;
        } else if (selectedValue === "MTech") {
            startYear += 2;
        }

        endYearSelectElem.innerHTML = "";

        // Generate options for end year based on start year selection
        for (var year = startYear; year <= currentYear; year++) {
            var option = document.createElement("option");
            option.value = year;
            option.text = year;
            endYearSelectElem.appendChild(option);
        }
    }

    // Event listener for start year select elements
    for (var i = 0; i < startYearSelect.length; i++) {
        var startYearSelectElem = startYearSelect[i];
        var endYearSelectElem = endYearSelect[i];
        startYearSelectElem.addEventListener("change", function () {
            updateEndYearOptions(this, this.parentNode.nextElementSibling.querySelector("select[name^='academicDetails'][name$='.EndYear']"));
        });
    }

    // Event listener for + Add Academic button
    var addAcademicButton = document.getElementById("addAcademic");
    addAcademicButton.addEventListener("click", function () {
        var academicEntry = document.querySelector(".academicEntry");
        var clone = academicEntry.cloneNode(true);
        var academicContainer = document.getElementById("academicContainer");
        academicContainer.appendChild(clone);

        var clonedStartYearSelectElem = clone.querySelector("select[name^='academicDetails'][name$='.StartYear']");
        var clonedEndYearSelectElem = clone.querySelector("select[name^='academicDetails'][name$='.EndYear']");

        // Reset selected values
        clonedStartYearSelectElem.selectedIndex = 0;
        clonedEndYearSelectElem.innerHTML = "";

        // Add event listener to the cloned start year select element
        clonedStartYearSelectElem.addEventListener("change", function () {
            updateEndYearOptions(this, this.parentNode.nextElementSibling.querySelector("select[name^='academicDetails'][name$='.EndYear']"));
        });

        // Get the new file input and update its name
        var clonedFileInput = clone.querySelector("input[type='file']");
        var fileIndex = document.querySelectorAll("input[type='file']").length - 1;
        clonedFileInput.name = "academicDetails[" + fileIndex + "].proof";
    });
</script>
